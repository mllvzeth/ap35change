---
import { sanityClient, urlFor } from '../lib/sanity';
import Layout from '../layouts/Layout.astro';

const query = `*[_type == "post"] | order(publishedAt desc) {
_id,
title,
slug,
publishedAt,
mainImage,
"author": author->name,
"categories": categories[]->title,
body
}`;

const posts = await sanityClient.fetch(query);
---

<Layout title="Bridging the Digital Divide: A Non-Techie's Guide to Perplexity AI">
    <header class="header sticky top-0 z-100 backdrop-blur-md">
        <div class="container mx-auto px-4">
            <nav class="nav flex flex-col gap-4 items-center justify-between py-4">
                <div class="nav__brand flex flex-col gap-1 items-center">
                    <h1 class="nav__title text-xl w-fit">Santa Cruz AI Labs</h1>
                    <p class="nav__subtitle m-auto w-auto text-muted-foreground w-fit">AI literacy for the Central Coast</p>
                </div>
                <div class="nav__menu gap-2 flex items-center">
                    <button class="btn btn--outline btn--sm" id="categoryFilter">All Posts</button>
                    <button class="btn btn--outline btn--sm" id="searchBtn">Search</button>
                    <button class="theme-toggle bg-[var(--color-secondary)] border border-(--color-border) py-[3px] px-2 rounded-(--radius-lg) cursor-pointer" id="themeToggle" aria-label="Toggle dark mode">
                        <span class="theme-toggle__icon">ðŸŒ™</span>
                    </button>
                </div>
            </nav>
        </div>
    </header>
    <main class="main">
        <section class="hero px-4">
            <div class="container">
                <div class="hero__content">
                    <h1 class="hero__title text-2xl font-bold mb-4 leading-tight md:text-3xl">A Non-Techie's Guide to Perplexity AI</h1>
                    <p class="hero__description">AI is reshaping access to information, lowering the barrier to entry. Join us thro </p>
                </div>
            </div>
        </section>
        <h1>Blog Posts</h1>
        <section>
            {posts.length === 0 ? (
            <p>No posts found. Create some posts in your Sanity Studio!</p>
            ) : (
            <div class="posts">
                {posts.map((post: any) => (
                <a href={`/post/${post.slug.current}`}><article class="post">
                    <h2>{post.title}</h2>
                    {post.mainImage && (
                    <img
                        src={urlFor(post.mainImage).width(800).url()}
                        alt={post.title}
                        width="800"
                    />
                    )}
                    {post.publishedAt && (
                    <time>{new Date(post.publishedAt).toLocaleDateString()}</time>
                    )}
                    {post.author && <p>By {post.author}</p>}
                    {post.categories && post.categories.length > 0 && (
                    <div class="categories">
                        {post.categories.map((cat: string) => (
                        <span class="category">{cat}</span>
                        ))}
                    </div>
                    )}
                </article>
                </a>
                ))}
            </div>
            )}
        </section>
    </main>
</Layout>
